#### English | [PortuguÃªs](./README-PT.md)

# Mister Qi is a Real NPC
[Mister Qi is a Real NPC](https://www.nexusmods.com/stardewvalley/mods/16724) is a Content patcher mod that turns Mister Qi into a giftable NPC by adding him as a custom NPC. The mod brings a new history to the character while respecting Mister Qi's original personality.

# Requirements
Currently, the mod needs 2 mods to work:
- [Content Patcher](https://www.nexusmods.com/stardewvalley/mods/1915) - By Pathoschild
- [Extra Map Layers](https://www.nexusmods.com/stardewvalley/mods/9633) - By aedenthorn

# Installing instructions
To install the mod, just copy it to your game's Mods folder. To uninstall it, just remove the **[CP] Mister Qi is a Real NPC** folder from your Mods folder.

# What is currently working?
The mod is under development and some things are not completed yet, but some things are already working, for example:
- Mr. Qi is recognized as a giftable NPC by the game.
- There are new dialogues up to 4 hearts.
- There are 4 events ready, 2 of them are heart events.
- 2 new maps have been added.

As the mod is updated, more functions will be added, removed, or modified.

# What is currently working?
The mod is under development and some things are not completed yet, but some things are already working, for example:
- Mr. Qi is recognized as a giftable NPC by the game.
- There are new dialogues up to 4 hearts.
- There are 4 events ready, 2 of them are heart events.
- 2 new maps have been added.

As the mod is updated, more functions will be added, removed, or modified.

# What does not work/is not 100% ready?
Currently there are a few things that are not complete yet, I will finish them as soon as possible:
- The schedules are incomplete, there is only the Spring schedule.
- Gift tastes are not yet defined. At the moment they are the same as Abigail's gift tastes with a few changes.
- Mr. Qi doesn't appear in any festivals.
- You cannot invite him to watch a movie
- The 6, 8 and 10 heart dialogs are missing.
- The 6, 8 and 10 heart events are missing.

In my testing, there's nothing that isn't working, there are just some incomplete features that will be completed as updates roll out. If you have any suggestions or find any bugs, feel free to comment on the Nexus Mods [posts](https://www.nexusmods.com/stardewvalley/mods/16724?tab=posts) page.

# More Details
Here are some details about what is currently added, some things may change in the course of updates.

## Mod Settings
This mod brings a setting, which can be changed when you open the game for the first time after installing the mod:

#### Kid or Name
This setting allows you to change the way Mr. Qi will refer to you in some dialogues, he may refer to you as "Kid" or your farmer's name. By default, it uses your farmer's name.

## New Maps
This mod adds 2 new maps to the game: Mr. Qi's room and a small laboratory.

### Mr. Qi's room map:
> ![QiRoom](https://github.com/Sionkob/MrQiRealNPC/assets/135146475/50b72d08-9915-4ff7-8b88-aad040267e2e)

Mr. Qi's room can be accessed through a corridor in the Casino.

### Lab map:
> ![QiLab](https://github.com/Sionkob/MrQiRealNPC/assets/135146475/893a2c2e-0f97-4b30-981c-9545d42ee1da)

The entrance to Mr. Qi's laboratory is at the door in the center of the small hallway in his room. The laboratory can only be accessed when the player has 6 hearts or more with Mr. Qi. If the player doesn't have enough hearts, the entrance to Mr. Qi's laboratory will be closed with an invisible wall that prevents the player from passing through.

## Events
Currently there are 4 events added, 2 of them are heart events, more events will be added over time. These are the preconditions to trigger each event:

#### Event #1
Enter the Casino after obtaining the [Club Card](https://stardewvalleywiki.com/Club_Card).

#### Event #2
After reaching level 100 of the [Skull Cavern](https://stardewvalleywiki.com/Skull_Cavern) after reading [Secret Note #10](https://stardewvalleywiki.com/Secret_Notes#Secret_Note_.2310), return to the entrance of the Skull Cavern.

#### Event #3
Having 2 hearts with Mr. Qi, enter the [Casino](https://stardewvalleywiki.com/Casino) at any time.

#### Event #4
Having 4 hearts with Mr. Qi, enter the [Oasis](https://stardewvalleywiki.com/Oasis) between 9AM and 9PM

## Schedules
Currently there is only the Spring schedule, which applies to all seasons.

Mr. Qi leaves his room at 7am and stays in the casino until noon, afterwards he goes into his laboratory and stays there until midnight, when he goes to sleep. Between 7pm and midnight, if you enter the [Nut Room](https://stardewvalleywiki.com/Qi%27s_Walnut_Room) you will find him looking at the screen in front of him. You won't get friendship points by interacting with him when he's in the Nut Room, and there are no dialogues set for him when he's there either.

It can be difficult to get friendship points with him at first because he spends a lot of time in the lab, which is inaccessible to the player until you have 6 hearts with him. He also spends little time in the Casino, one of the few times you can talk to him. I'll improve this schedule and add new times for weekdays and other seasons.

## Gift Tastes
Now Mr. Qi has his own gift tastes, see the table below:

| Gift Taste 	| Items                                                                                                                                                                                                                                                                                                                                                                                                                          	|
|------------	|--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------	|
| Love       	| [Life Elixir](https://stardewvalleywiki.com/Life_Elixir), [Dinosaur Egg](https://stardewvalleywiki.com/Dinosaur_Egg), [Fried Mushroom](https://stardewvalleywiki.com/Fried_Mushroom), [Miner's Treat](https://stardewvalleywiki.com/Miner%27s_Treat), [Squid](https://stardewvalleywiki.com/Squid), [Star Shards](https://stardewvalleywiki.com/Star_Shards), [Radioactive Bar](https://stardewvalleywiki.com/Radioactive_Bar) 	|
| Like       	| [Pancakes](https://stardewvalleywiki.com/Pancakes), [Lava Eel](https://stardewvalleywiki.com/Lava_Eel), [Midnight Squid](https://stardewvalleywiki.com/Midnight_Squid),[Tom Kha Soup](https://stardewvalleywiki.com/Tom_Kha_Soup), [Spicy Eel](https://stardewvalleywiki.com/Spicy_Eel), [Ginger Ale](https://stardewvalleywiki.com/Ginger_Ale)                                                                                	|
| Dislike    	| All cooking items (except Fried Mushroom, Pancakes, Tom Kha Soup, Spicy Eel, Ginger Ale, Coffee, Triple Shot Expresso and Escargot), Artisan Goods items                                                                                                                                                                                                                                                                       	|
| Hate       	| [Escargot](https://stardewvalleywiki.com/Escargot), [Triple Shot Expresso](https://stardewvalleywiki.com/Triple_Shot_Espresso), [Coffee](https://stardewvalleywiki.com/Coffee), [Wine (any tipe)](https://stardewvalleywiki.com/Wine), [Beer](https://stardewvalleywiki.com/Beer), [Pale Ale](https://stardewvalleywiki.com/Pale_Ale)                                                                                          	|
| Neutral    	| Fishes, Minerals and Gems                                                                                                                                                                                                                                                                                                                                                                                                      	|

# Known Errors
Currently there is only one "bug" in the mod:

When opening the game for the first time (or at the beginning of each day), if you open the SMAPI console, you will encounter an error similar to this:

`[ERROR game] Failed parsing schedule for NPC Mister Qi:
0 QiNutRoom 5 2 1/1920 QiNutRoom 7 4 0 mrqi_staring/2400 QiNutRoom 5 2 1
ArgumentException: In warpCharacter, the character's currentLocation must not be null
   at StardewValley.Game1.warpCharacter(NPC character, GameLocation targetLocation, Vector2 position)
   at StardewValley.NPC.parseMasterSchedule_Patch1(NPC this, String rawData)`

This error happens because there are 2 "Mister Qi" in the game, each with a different internal name. One of them has the internal name set to "Mister Qi". This Mister Qi cannot be turned into a giftable NPC (i.e. it's not possible to befriend him), but apparently he can have a schedule, even if the SMAPI console returns an error. In my tests even with this error, the schedule works normally, this error can be ignored, at least for now. I still don't know how to fix this error, but I'm studying ways to solve it as soon as possible.
